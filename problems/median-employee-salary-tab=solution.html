<!doctype html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  
  <meta name="description" content="The Employee table holds all employees. The employee table has three columns: Employee Id, Company Name, and Salary.

+-----+------------+--------+
|Id   | Company    | Salary |
+-----+------------+--------+
|1    | A          | 2341   |
|2    | A          | 341    |
|3    | A          | 15     |
|4    | A          | 15314  |
|5    | A          | 451    |
|6    | A          | 513    |
|7    | B          | 15     |
|8    | B          | 13     |
|9    | B          | 1154   |
|10   | B          | 1345   |
|11   | B          | 1221   |
|12   | B          | 234    |
|13   | C          | 2345   |
|14   | C          | 2645   |
|15   | C          | 2645   |
|16   | C          | 2652   |
|17   | C          | 65     |
+-----+------------+--------+

Write a SQL query to find the median salary of each company. Bonus points if you can solve it without using any built-in SQL functions.

+-----+------------+--------+
|Id   | Company    | Salary |
+-----+------------+--------+
|5    | A          | 451    |
|6    | A          | 513    |
|12   | B          | 234    |
|9    | B          | 1154   |
|14   | C          | 2645   |
+-----+------------+--------+">
  <meta name="keywords"
        content="Median Employee Salary, LC 569, leetcode 569, leaked interview questions, hackerank free, bittiger free"/>



  <meta name="author" content="">
  <link rel="icon" href="../favicon.ico">

  <title>LeetFree - Leaked Interview questions from Google Facebook Amazon Microsoft LinkedIn</title>

  <!-- Bootstrap core CSS -->
  <link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

  <link href="https://use.fontawesome.com/releases/v5.0.1/css/all.css" rel="stylesheet">

  <!-- <link href="/css/fontawesome-all.min.css" rel="stylesheet"> -->
  <!-- <link href="/css/open-iconic-bootstrap.min.css" rel="stylesheet"> -->

  <!-- DataTable -->
  <!-- <link href="//cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.0.0-beta/css/bootstrap.css" rel="stylesheet">
  <link href="https://cdn.datatables.net/1.10.16/css/dataTables.bootstrap4.min.css" rel="stylesheet"> -->

  
  <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.6-rc.0/css/select2.min.css" rel="stylesheet"/>
  <!--<link href="/css/codemirror.css" rel="stylesheet">-->

  <style type="text/css">.CodeMirror {
      border: 1px solid gray;
      height: 100%;
    }
  </style>



  <!-- Custom styles for this template -->
  <link href="../maincss.css" rel="stylesheet">


  <!-- Global site tag (gtag.js) - Google Analytics -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=UA-111377072-1"></script>
  <script>
      window.dataLayer = window.dataLayer || [];

      function gtag() {
          dataLayer.push(arguments);
      }

      gtag('js', new Date());

      gtag('config', 'UA-111377072-1');
  </script>
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
  <script>
    (adsbygoogle = window.adsbygoogle || []).push({
      google_ad_client: "ca-pub-8728288618103299",
      enable_page_level_ads: true
    });
  </script>

  <!-- Baidu Analytics -->









</head>

<body>

<div class="blog-masthead">
  <div class="container">
    <nav class="blog-nav">
      <a class="blog-nav-item" href="../index.html">All Questions</a>
      <a class="blog-nav-item" href="../company/google.html">Google</a>
      <a class="blog-nav-item" href="../company/facebook.html">Facebook</a>
      <a class="blog-nav-item" href="../company/microsoft.html">Microsoft</a>
      <a class="blog-nav-item" href="../company/amazon.html">Amazon</a>
      <a class="blog-nav-item" href="../company/uber.html">Uber</a>
      <a class="blog-nav-item" href="../company/linkedin.html">LinkedIn</a>
      <a class="blog-nav-item" href="../company/twitter.html">Twitter</a>
      <a class="blog-nav-item" href="../company/airbnb.html">Airbnb</a>
      <a class="blog-nav-item" href="../company/snapchat.html">Snapchat</a>
    </nav>
  </div>
</div>

<div class="container">
  

  <div class="blog-header">
    <div class="alert alert-info" role="alert">This website contains ALL LeetCode <b>Premium</b> <i
            class="fas fa-unlock-alt"></i> problems for
      <b>FREE!!</b>.<br/>
      All leaked interview problems are collected from Internet.
    </div>

    <h2>569. Median Employee Salary</h2>
  </div>

  <div class="row">
    <div class="col-md-9 blog-main">
      <div>
        <!-- Nav tabs -->
        <ul class="nav nav-tabs" role="tablist" id="myTabs">
          <li role="presentation" class="active" id="question-li"><a href="#question" aria-controls="question"
                                                                     role="tab"
                                                                     data-toggle="tab">Question</a>
          </li>
          <li role="presentation" id="solution-li"><a href="#solution" aria-controls="solution" role="tab"
                                                      data-toggle="tab"><i class="fas fa-unlock-alt"></i> Solution</a>
          </li>
        </ul>

        <!-- Tab panes -->
        <div class="tab-content">

          <div role="tabpanel" class="tab-pane active" id="question">
            <br/>
            <p>
The <code>Employee</code> table holds all employees. The employee table has three columns: Employee Id, Company Name, and Salary.</p>

<pre>
+-----+------------+--------+
|Id   | Company    | Salary |
+-----+------------+--------+
|1    | A          | 2341   |
|2    | A          | 341    |
|3    | A          | 15     |
|4    | A          | 15314  |
|5    | A          | 451    |
|6    | A          | 513    |
|7    | B          | 15     |
|8    | B          | 13     |
|9    | B          | 1154   |
|10   | B          | 1345   |
|11   | B          | 1221   |
|12   | B          | 234    |
|13   | C          | 2345   |
|14   | C          | 2645   |
|15   | C          | 2645   |
|16   | C          | 2652   |
|17   | C          | 65     |
+-----+------------+--------+
</pre>

<p>Write a SQL query to find the median salary of each company. Bonus points if you can solve it without using any built-in SQL functions.</p>

<pre>
+-----+------------+--------+
|Id   | Company    | Salary |
+-----+------------+--------+
|5    | A          | 451    |
|6    | A          | 513    |
|12   | B          | 234    |
|9    | B          | 1154   |
|14   | C          | 2645   |
+-----+------------+--------+
</pre>
          </div>
          <div role="tabpanel" class="tab-pane" id="solution">
            <br/>
            <div class="block-markdown">
<div class="toc">
<ul>
<li><a href="#solution">Solution</a><ul>
<li><a href="#approach-1-using-the-definition-of-median-accepted">Approach #1: Using the definition of median [Accepted]</a></li>
<li><a href="#approach-2-sort-and-then-select-the-median-accepted">Approach #2: Sort and then select the median [Accepted]</a></li>
</ul>
</li>
</ul>
</div>
<h2 id="solution">Solution</h2>
<hr/>
<h4 id="approach-1-using-the-definition-of-median-accepted">Approach #1: Using the definition of <em>median</em> [Accepted]</h4>
<p><strong>Intuition</strong></p>
<p>By the definition of <em>median</em>, the count of the bigger numbers than itself should be equal to the count of the smaller ones in an <em>odd</em> array.</p>
<p><strong>Algorithm</strong></p>
<p>Take array [1,3,2] for example, is the first number 1 the median? No, because this array only have 3 elements but there are 2 of them (3, 2) are greater than 1. To continue, we know 3 is not the median as well since there are 2 elements smaller. But for the last element 2, there are equal amount of bigger and smaller numbers. So it is the median in this array!</p>
<p>What if an array has <em>even</em> amount of distinct values, the median is the average of the middle <em>two elements</em> next to each other  after sorting this array.  It is not hard to understand that for either of these two elements, the difference (absolute value) of its bigger and smaller number than itself in this array is 1, which is the exactly frequency of a element in the distinct array.</p>
<p>So in general, the median's frequency should be equal or grater than the absolute difference of its bigger elements and small ones in an array no matter whether it has odd or even amount of numbers and whether they are distinct. This rule is the key, and it is represented as the following code.</p>
<div class="codehilite"><pre><span></span><span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="o">=</span> <span class="k">alias</span><span class="p">.</span><span class="n">Salary</span> <span class="k">THEN</span> <span class="mi">1</span>
    <span class="k">ELSE</span> <span class="mi">0</span>
<span class="k">END</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">ABS</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">SIGN</span><span class="p">(</span><span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="o">-</span> <span class="k">alias</span><span class="p">.</span><span class="n">Salary</span><span class="p">)))</span>
</pre></div>
<p>Thus, this approach is as following in MySQL code.</p>
<p><strong>MySQL</strong></p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span>
    <span class="n">Employee</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Company</span><span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span>
<span class="k">FROM</span>
    <span class="n">Employee</span><span class="p">,</span>
    <span class="n">Employee</span> <span class="k">alias</span>
<span class="k">WHERE</span>
    <span class="n">Employee</span><span class="p">.</span><span class="n">Company</span> <span class="o">=</span> <span class="k">alias</span><span class="p">.</span><span class="n">Company</span>
<span class="k">GROUP</span> <span class="k">BY</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Company</span> <span class="p">,</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span>
<span class="k">HAVING</span> <span class="k">SUM</span><span class="p">(</span><span class="k">CASE</span>
    <span class="k">WHEN</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="o">=</span> <span class="k">alias</span><span class="p">.</span><span class="n">Salary</span> <span class="k">THEN</span> <span class="mi">1</span>
    <span class="k">ELSE</span> <span class="mi">0</span>
<span class="k">END</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="k">ABS</span><span class="p">(</span><span class="k">SUM</span><span class="p">(</span><span class="n">SIGN</span><span class="p">(</span><span class="n">Employee</span><span class="p">.</span><span class="n">Salary</span> <span class="o">-</span> <span class="k">alias</span><span class="p">.</span><span class="n">Salary</span><span class="p">)))</span>
<span class="k">ORDER</span> <span class="k">BY</span> <span class="n">Employee</span><span class="p">.</span><span class="n">Id</span>
<span class="p">;</span>
</pre></div>
<blockquote>
<p>Note: In MySQL 5.6, this code runs fine, but if you are using MySQL 5.7+, please use <code>ANY_VALUE(Employee.Id)</code> instead of <code>Employee.Id</code> in the SELECT statement. Otherwise, you may encouter the following error message:
Error Code: 1055. Expression #1 of SELECT list is not in GROUP BY clause and contains nonaggregated column 'Employee.Id' which is not functionally dependent on columns in GROUP BY clause; this is incompatible with sql_mode=only_full_group_by.
For more details on how to user <code>ANY_VALUE(arg)</code>, please refer to this <a href="https://dev.mysql.com/doc/refman/5.7/en/miscellaneous-functions.html#function_any-value">link</a>.</p>
</blockquote>
<hr/>
<h4 id="approach-2-sort-and-then-select-the-median-accepted">Approach #2: Sort and then select the <em>median</em> [Accepted]</h4>
<p><strong>Intuition</strong></p>
<p>In general, we can just pick the middle one(s) to get the <em>median</em> if the records are ranked by <strong>salary</strong>. But how can we get them sorted particularly MySQL does not have the build-in rank function, and these are several companies in this case.</p>
<p><strong>Algorithm</strong></p>
<p>By adding a virtual column to simulate the ranking, we can sort these records by <strong>salary</strong> and pick up the middle one(s). Here we need to use the session variable to achieve this goal.</p>
<p>This approach is more efficient than the first one since it does not calculate all the <strong>salary</strong> one by one in the table.</p>
<div class="codehilite"><pre><span></span><span class="k">SELECT</span> 
    <span class="n">Id</span><span class="p">,</span> <span class="n">Company</span><span class="p">,</span> <span class="n">Salary</span>
<span class="k">FROM</span>
    <span class="p">(</span><span class="k">SELECT</span> 
        <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">,</span>
            <span class="n">e</span><span class="p">.</span><span class="n">Salary</span><span class="p">,</span>
            <span class="n">e</span><span class="p">.</span><span class="n">Company</span><span class="p">,</span>
            <span class="k">IF</span><span class="p">(</span><span class="o">@</span><span class="n">prev</span> <span class="o">=</span> <span class="n">e</span><span class="p">.</span><span class="n">Company</span><span class="p">,</span> <span class="o">@</span><span class="n">Rank</span><span class="p">:</span><span class="o">=@</span><span class="n">Rank</span> <span class="o">+</span> <span class="mi">1</span><span class="p">,</span> <span class="o">@</span><span class="n">Rank</span><span class="p">:</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">AS</span> <span class="n">rank</span><span class="p">,</span>
            <span class="o">@</span><span class="n">prev</span><span class="p">:</span><span class="o">=</span><span class="n">e</span><span class="p">.</span><span class="n">Company</span>
    <span class="k">FROM</span>
        <span class="n">Employee</span> <span class="n">e</span><span class="p">,</span> <span class="p">(</span><span class="k">SELECT</span> <span class="o">@</span><span class="n">Rank</span><span class="p">:</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="o">@</span><span class="n">prev</span><span class="p">:</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span> <span class="k">AS</span> <span class="n">temp</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">e</span><span class="p">.</span><span class="n">Company</span> <span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Salary</span> <span class="p">,</span> <span class="n">e</span><span class="p">.</span><span class="n">Id</span><span class="p">)</span> <span class="n">Ranking</span>
        <span class="k">INNER</span> <span class="k">JOIN</span>
    <span class="p">(</span><span class="k">SELECT</span> 
        <span class="k">COUNT</span><span class="p">(</span><span class="o">*</span><span class="p">)</span> <span class="k">AS</span> <span class="n">totalcount</span><span class="p">,</span> <span class="n">Company</span> <span class="k">AS</span> <span class="n">name</span>
    <span class="k">FROM</span>
        <span class="n">Employee</span> <span class="n">e2</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">e2</span><span class="p">.</span><span class="n">Company</span><span class="p">)</span> <span class="n">companycount</span> <span class="k">ON</span> <span class="n">companycount</span><span class="p">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">Ranking</span><span class="p">.</span><span class="n">Company</span>
<span class="k">WHERE</span>
    <span class="n">Rank</span> <span class="o">=</span> <span class="n">FLOOR</span><span class="p">((</span><span class="n">totalcount</span> <span class="o">+</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
        <span class="k">OR</span> <span class="n">Rank</span> <span class="o">=</span> <span class="n">FLOOR</span><span class="p">((</span><span class="n">totalcount</span> <span class="o">+</span> <span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="mi">2</span><span class="p">)</span>
<span class="p">;</span>
</pre></div>
</div>
          </div>
        </div>
      </div>

    </div>

    <aside class="col-md-3  blog-sidebar">
      <div class="row sidebar-module">
        <ul class="list-group">
          <li class="list-group-item"><span>Difficulty:</span><span class="pull-right">
                              
                                <button class="btn btn-xs btn-danger disabled">Hard</button>
                              
          </span></li>
          <li class="list-group-item"><span>Total Accepted:</span><span class="pull-right">805</span>
          </li>
          <li class="list-group-item"><span>Total Submissions:</span><span
                  class="pull-right">2302</span></li>

          <li class="list-group-item" style="background: #eee;"><span><i
                  class="fas fa-unlock-alt"></i> Frequency:</span>
            <span class="pull-right">
              5%
            </span>
          </li>
        </ul>
        <ul class="list-group">

          <li class="list-group-item">
            <h4><i class="fas fa-unlock-alt"></i> Companies (leaked): </h4>
            
              <a style="margin:2px" class="btn btn-sm btn-success" href="../company/google.html">Google</a>
            
          </li>

        </ul>
      </div>
    </aside>

  </div>

  <div class="row" >
    <div class="col-md-2">
      <select class="js-example-basic-single" name="state" style="width: 100%;" id="language">
        <option value="cpp">C++</option>
        <option value="py2">Python 2</option>
        <option value="py3">Python 3</option>
      </select>
    </div>
    <div class="col-md-2">

    </div>
  </div>

  <div class="row" >
    <div class="col-md-12 blog-main">
      <div>
        
        <textarea id="code_cpp" name="code_cpp">
          
            
        </textarea>
        
        <textarea id="code_py2" name="code_py2">
          
            
        </textarea>
        
        <textarea id="code_py3" name="code_py3">
          
            
        </textarea>
        
      </div>
    </div>
  </div>
  <div class="row">
    <div class="col-md-12 blog-main">
      <a href="#" class="btn btn-primary" id="submit">Submit Solution</a>
    </div>
  </div>



</div>
<!-- /.container -->

<footer class="blog-footer">
  <a href="mailto:leetfree@gmail.com">Email: leetfree@gmail.com</a>
  <p class="pull-right"><a href="#">Back to top</a></p>
</footer>

<!-- Bootstrap core JavaScript
================================================== -->
<!-- Placed at the end of the document so the pages load faster -->
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
<script>
    window.jQuery || document.write('<script src="/assets/js/vendor/jquery.min.js"><\/script>')
</script>
<script src="../js/bootstrap.min.js"></script>
<!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
<script src="../assets/js/ie10-viewport-bug-workaround.js"></script>


<!-- DataTable -->
<!-- <script src="https://cdn.datatables.net/1.10.16/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.10.16/js/dataTables.bootstrap4.min.js"></script> -->

<script src="../main.js"></script>





</body>

</html>